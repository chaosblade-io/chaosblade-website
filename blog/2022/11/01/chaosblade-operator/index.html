<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">大规模 Kubernetes 集群故障注入的利器-ChaosBlade | ChaosBlade</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://chaosblade.io/img/cb-logo.png"><meta data-rh="true" name="twitter:image" content="https://chaosblade.io/img/cb-logo.png"><meta data-rh="true" property="og:url" content="https://chaosblade.io/blog/2022/11/01/chaosblade-operator"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" property="og:title" content="大规模 Kubernetes 集群故障注入的利器-ChaosBlade | ChaosBlade"><meta data-rh="true" name="description" content="本文将主要介绍 ChaosBlade 在 Kubernetes 中故障注入的底层实现原理、版本优化过程以及大规模应用演练测试。。"><meta data-rh="true" property="og:description" content="本文将主要介绍 ChaosBlade 在 Kubernetes 中故障注入的底层实现原理、版本优化过程以及大规模应用演练测试。。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-11-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/tiny-x"><meta data-rh="true" property="article:tag" content="chaosblade"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://chaosblade.io/blog/2022/11/01/chaosblade-operator"><link data-rh="true" rel="alternate" href="https://chaosblade.io/en/blog/2022/11/01/chaosblade-operator" hreflang="en"><link data-rh="true" rel="alternate" href="https://chaosblade.io/blog/2022/11/01/chaosblade-operator" hreflang="zh"><link data-rh="true" rel="alternate" href="https://chaosblade.io/blog/2022/11/01/chaosblade-operator" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://AJZLJ48ZRO-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ChaosBlade RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ChaosBlade Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FY5W27B8XH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FY5W27B8XH",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ChaosBlade" href="/opensearch.xml">
<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=block">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=block">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/assets/css/styles.73868530.css">
<link rel="preload" href="/assets/js/runtime~main.48f47abc.js" as="script">
<link rel="preload" href="/assets/js/main.4a70f144.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️  &nbsp; If you like ChaosBlade, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/chaosblade-io/chaosblade">GitHub</a>! ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cb-head.png" alt="ChaosBlade" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/cb-head.png" alt="ChaosBlade" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ChaosBlade</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/">1.7.4</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next</a></li><li><a class="dropdown__link" href="/docs/">1.7.4</a></li><li><a class="dropdown__link" href="/docs/1.7.3/">1.7.3</a></li><li><a class="dropdown__link" href="/docs/1.7.2/">1.7.2</a></li><li><a class="dropdown__link" href="/docs/1.7.1/">1.7.1</a></li><li><a class="dropdown__link" href="/docs/1.7.0/">1.7.0</a></li></ul></div><a class="navbar__item navbar__link" href="/docs">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/chaosblade-io/chaosblade" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-githab-link"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/en/blog/2022/11/01/chaosblade-operator" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/blog/2022/11/01/chaosblade-operator" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">全部博文</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/08/17/chaosblade-first">混沌工程之ChaosBlade利刃出鞘</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/20/maintainer-yuanning-en">ChaosBlade Maintainer Promotion Notice -- CHAO YUANNING</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/20/maintainer-yuanning">ChaosBlade Maintainer 晋升通告 -- 晁元宁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/10/chaosblade-contribution-by-redis">由Redis故障场景，说说ChaosBlade贡献的二三事</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/09/reviewer-yuanning">ChaosBlade Reviewer 晋升通告 -- 晁元宁</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2022/11/01/chaosblade-operator">大规模 Kubernetes 集群故障注入的利器-ChaosBlade</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/09/chaosblade-java">ChaosBlade Java 场景性能优化，那些你不知道的事</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released-ch">ChaosBlade-Box全新混沌工程平台 -- 助力企业混沌工程落地</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released">ChaosBlade-Box, a New Version of the Chaos Engineering Platform Has Released</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/24/ChaosBlade-Box-new-release">混沌工程平台 ChaosBlade-Box 新版重磅发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/03/ChaosBlade-From-the-Chaos-Engineering-Experiment-Tool-to-the-Chaos-Engineering-Platform">ChaosBlade, From the Chaos Engineering Experiment Tool to the Chaos Engineering Platform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/12/08/chaos-engineering-value">被你质疑价值的混沌工程，阿里巴巴已落地实践了9年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/06/summer-2021">暑期2021</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/05/21/chaos-engineering">混沌工程介绍与实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/08/06/chaosblade-start-5">ChaosBlade：从零开始的混沌工程（五）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/07/22/chaosblade-start-4">ChaosBlade：从零开始的混沌工程（四）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/06/15/chaosblade-start-3">ChaosBlade：从零开始的混沌工程（三）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/06/09/chaosblade-start-2">ChaosBlade：从零开始的混沌工程（二）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/06/04/chaosblade-start-1">ChaosBlade：从零开始的混沌工程（一）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/10/17/chaosblade-cloud-native">ChaosBlade：云原生架构下的混沌工程探索和实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/03/chaosblade-chaos-engineering-tools">Chaosblade, 阿里一个超级牛逼的混沌实验实施工具</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="本文将主要介绍 ChaosBlade 在 Kubernetes 中故障注入的底层实现原理、版本优化过程以及大规模应用演练测试。。"><header><h1 class="title_f1Hy" itemprop="headline">大规模 Kubernetes 集群故障注入的利器-ChaosBlade</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-11-01T00:00:00.000Z" itemprop="datePublished">2022年11月1日</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tiny-x" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/29175949?v=4" alt="叶飞（@tiny-x）" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tiny-x" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">叶飞（@tiny-x）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade">ChaosBlade<a href="#chaosblade" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>随着云原生的发展，云原生应用一致性、可靠性、灵活编排的能力让大部分企业选择将应用往云上迁移，但同时云基础设施在稳定性、高可用、可观测方面也接受着强大的考验。
ChaosBlade 是阿里巴巴开源的一款遵循混沌工程原理和混沌实验模型的实验注入工具，帮助企业提升分布式系统的容错能力，并且在企业上云或往云原生系统迁移过程中提供业务连续性保障。
ChaosBlade Operator 是 Kubernetes 平台实验场景的实现，将混沌实验通过 Kubernetes 标准的 CRD 方式定义，很方便地使用 Kubernetes 资源操作的方式来创建、更新、删除实验场景，包括使用 kubectl、client-go 等方式执行，同时也可以使用 chaosblade cli 工具执行。</p><p><strong>本文将主要介绍 ChaosBlade 在 Kubernetes 中故障注入的底层实现原理、版本优化过程以及大规模应用演练测试。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="资源模型">资源模型<a href="#资源模型" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>在 Kubernetes 中部署应用，通常我们会选择将应用定义为 pod、Deployment、Statefulset 等资源类型，这些都是 Kubernetes 已经内置的；在实际应用中，面对复杂的应用场景，内置的资源类型是无法满足我们需求的，Operator 是一种解决复杂应用容器化的一种方案，通过自定义资源和自定义控制器来实现复杂应用容器化，chaosblade-operator 正是就是基于 Operator 实现的。
在 Kubernetes 中安装完 chaosblade-operator 后，会生成一个 deployment 资源类型的  chaosblade-operator 实例、一个 daemonset 资源类型的  chaosblade-tool 实例、一个自定义资源定义，当然还包含 RABC、SA 等等其他资源；
<img loading="lazy" alt="image.png" src="data:image/png;base64,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" width="1016" height="288" class="img_ev3q">
chaosblade 将自定义资源类型定义为  chaosblade ，简称 blade ；每次新建演练就可以通过 kubectl 或者 chaosblade cli 创建 blade 实例资源，blade 资源本身也包含了 chaosblade 混沌实验定义；
chaosblade-operator 会监听 blade 资源的生命周期，当发现有 blade 资源实例被创建时，同时就能拿到混沌实验定义，然后解析实验定义，去调用 chaosblade-tool 真正地注入故障；
chaosblade-tool 是 daemonset 资源类型，一个 Node 节点必定会部署一个 pod，从 Linux Namespace 的维度出发，该 pod 网络、PID 命名空间与 Node 节点处在同一命名空间，因此可以做到部分 Node 级别的演练。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="生命周期">生命周期<a href="#生命周期" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>在资源模型中，简单提到了 chaosblade-operator 会监听 blade 资源的创建； chaosblade-operator 实则会监听整个 blade 资源的生命周期，blade 资源的生命周期等同演练实验生命周期；chaosblade-operator 会根据 blade 资源状态去更新实验的状态。</p><table><thead><tr><th>blade 资源状态</th><th>实验过程</th><th>CPU 负载案例</th></tr></thead><tbody><tr><td>apply(新建)</td><td>新建演练</td><td>新建 CPU 负载演练</td></tr><tr><td>running(运行中)</td><td>演练运行中</td><td>CPU 负载中</td></tr><tr><td>deleted(被删除)</td><td>恢复演练</td><td>恢复演练</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="故障注入">故障注入<a href="#故障注入" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>在资源模型中提到了 chaosblade-operator 发现有 blade 资源实例被创建时，同时就能拿到混沌实验定义，然后解析实验定义，去真正地注入故障；那么 chaosblade-operator 是如何去真正地注入故障呢？
其实在早期的 chaosblade-operator 版本中，大部分场景是通过将 chaosblade cli 工具通过 kubenetes API 通道复制到容器内部，然后再去容器内部执行命令来实现故障注入，整体实现方案入下图；
<img loading="lazy" alt="1.5.x.png" src="/assets/images/early_stage_chaosblade_operator-9a10c0481a94d55ea4b899fdf4d238b2.png" width="992" height="414" class="img_ev3q">
可以看到左边的 yaml 定义就是 Chaosblade 混沌实验模型定义，也是 blade 资源实例的一部分信息，当 blade 资源通过 kubectl apply 以后，chaosblade-operator 会监听到资源的创建，同时解析到实验定义；
当解析到 scope = node 的时候，会找到 node 节点所在 chaosblade-tool pod 中执行命令，这些动作几乎对整个集群来说资源消耗也是极少的；
但是当解析到 scope = pod 或者  scope = container  的时候，大部分场景 chaosblade-operator 会把 chaosblade cli 工具本身复制到业务容器内部，然后再去业务容器执行命令，工具包的大小、实验选择的容器数量、决定了资源的消耗大小，往往兼容性、版本更新等等都得不到很好的保障；
<strong>在新版本的 chaosblade-operator 版本中，将在下面最初的问题、优化过程、实现原理等小节详细介绍。</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="最初的痛点">最初的痛点<a href="#最初的痛点" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>当一个云原生应用达到一定规模时，去进行演练；</p><ul><li>集群环境：1000 个 node 节点</li><li>目标应用：deployment 有 5000 个副本数</li><li>演练场景：对该应用对外提供的接口返回延迟 1000 毫秒</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入慢">注入慢<a href="#注入慢" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>首先需要找到 5000 个副本，将工具复制到容器，在进入容器执行命令，假设一个复制工具耗费 100 毫秒，那么整个过程耗费时间 500000 毫秒，这对用户来说简直是不可接受的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="网络带宽占用">网络带宽占用<a href="#网络带宽占用" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>将工具复制到容器，至少需要调用 kubernetes api 5000次，假设一个可执文件大小 5MB , 5000 次需要占用总带宽流量 5000x5=25000MB ，对 IO 影响简直就是灾难级别的；</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="兼容性问题">兼容性问题<a href="#兼容性问题" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>假设我们已经通过层层考验，已经工具将工具复制进去，当工具本身依赖了依赖一些命令，比如网络（tc）、磁盘（dd）等容器中又没有这些命令，或者版本不兼容该如何处理？</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="只读-pod">只读 pod<a href="#只读-pod" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>对于配置了只读文件系统的 pod，文件是不可写入的，因此压根就没发将工具复制进去</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="侵入型">侵入型<a href="#侵入型" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>将工具留在业务容器内部，等同于将工具生命周期与容器绑定在一起；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="优化过程">优化过程<a href="#优化过程" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>在最初版本的迭代过程我们做过很多优化，同步转异步、包瘦身、按需复制等等优化方案，虽然一定程度上提高了注入的效率，但是没有解决问题的本质，还是受限于主机的 IO 性能；
无论是同步转异步、包瘦身、按需复制等优化方案，本质没法解决工具复制带来的一些问题；羊毛出在羊身上，解决问题就得解决问题的本质，从 Linux 虚拟化技术的角度思考，如何不复制工具就在能容器中注入故障呢？</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-虚拟化">Linux 虚拟化<a href="#linux-虚拟化" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>对于 Linux 虚拟化技术而言，核心实现原理就是 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力，以及基于 rootfs 的文件系统；
Linux Namespace 可以让进程（容器）处在一个独立的沙箱环境，Linux Cgroups 可以限制该沙箱内进程的资源使用，比如限制 CPU、内存的使用率等等；</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-cgroups">Linux Cgroups<a href="#linux-cgroups" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><p>Linux Cgroups  可以限制沙箱内进程的资源使用，并且也可以人为将某个进程的资源使用交给已经存在的某个的 Linux Cgroups 控制，而通常容器的资源使用率统计也是 Linux Cgroups 控制组下面进程的使用情况计算出来的；此时在宿主机启动的一个 CPU 负载的进程，并且将该进程交给某个已经存在的容器的控制组控制，就相当于给该容器注入了 CPU 负载场景。
在  docker 上面尝试在不侵入该容器的情况下，给容器 nginx 注入 CPU 负载的场景。首先启动一个 nginx 容器 <code>docker run -it -d -p 8087:80 --cpus 0 --name nginx nginx</code>，容器启动后 docker 会给该容器新建一个 Cgroups  控制组，在该命令中会限制该容器只能使用一个核心的 CPU 。</p><ol><li>找到容器的进程 PID，该进程是容器启动时第一个进程</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> inspect --format </span><span class="token string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>查看进程的 Cgroups 控制组，可以看到有 CPU、内存、blkio 等等很多 Cgroup 子系统</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> inspect --format </span><span class="token variable string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token variable" style="color:#36acaa"> nginx</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/cgroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:devices:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:blkio:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9</span><span class="token plain">:pids:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:memory:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain">:freezer:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain">:perf_event:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5</span><span class="token plain">:cpuset:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain">:hugetlb:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">:cpuacct,cpu:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">:net_prio,net_cls:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">:name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">systemd:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>查看 CPU 控制组进程列表，可以有很多进程受该容器 Cgroup CPU 子系统控制；按照这个思路，我们只需要启动一个 CPU 负载进程，并且将进程 PID 写入这个文件，就可以做到容器 CPU 注入；</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /sys/fs/cgroup/cpu</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> /proc/</span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">docker inspect --format </span><span class="token variable string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token variable" style="color:#36acaa"> nginx</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable" style="color:#36acaa">/cgroup </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&#x27;:&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/tas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7921</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7980</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7981</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7982</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7983</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>CPU 负载脚本</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#! /bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>执行 CPU 负载脚本后找到 PID ，将进程写入容器进程列表文件</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> PID </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /sys/fs/cgroup/cpu</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> /proc/</span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">docker inspect --format </span><span class="token variable string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token variable" style="color:#36acaa"> nginx</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable" style="color:#36acaa">/cgroup </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&#x27;:&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/tas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>此时可以观察到容器 CPU 达到 100%，而宿主机未达到，说明 CPU 负载只对容器产生了效果，运用同样的方式，可以做到资源占用型的任何故障场景，比如内存、IO 等</li></ol><p>最终成功在不侵入该容器的情况下，给该容器注入 CPU 负载的场景。通过 Cgroups 控制组，还能做到其他 Cgroups 支持的子系统的场景注入，比如 CPU 高负载、内存占用高、IO 高负载等等；</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-namespace">Linux Namespace<a href="#linux-namespace" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><p>通过 Linux Cgroups 做到了不侵入该容器的情况下，给该容器注入 CPU 负载的场景，同时也能支持 CPU 高负载、内存占用高、IO 高负载等等； 对于其他类型的故障，比如网络延时、文件删除等等，则需要通过另外一种方式来实现 ， 就是 Linux Namespace 的隔离能力。
Linux Namespace 提供了网络、IPC、MNT 等命名空间隔离的能力，在容器独立的 Namespace 下，新建一个文件，新启动一个进程等等操作也是其他容器不可感知和观测到的；
在  docker 上面尝试在不侵入该容器的情况下，给 nginx 容器注入网络延时的场景。首先启动一个 nginx 容器 <code>docker run -it -d -p 8087:80 --cpus 0 --name nginx nginx</code>，在宿主机开放端口 8080 代理到容器内 80  端口， 容器启动后会有独立的网络命名空间，监听 80 端口。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="宿主机网络延时">宿主机网络延时<a href="#宿主机网络延时" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p>TC (TrafficControl) 用于Linux内核的流量控制，可以做到网络延时、丢包等等，先尝试利用 TC 在宿主机上注入网络延时，比如需要注入一个网络延时 100ms 的场景，在宿主机上执行如下命令</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#延时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tc qdisc </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> dev eth0 root netem delay 100ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时在客户端打开浏览器访问 <code>http://IP:8087</code> 会查看到有稳定 100ms 的延时，而仔细观测后会发现其他端口也会有延时，比如 22、3306 等等；（注意，只能在别的客户端机器访问，不能在直接在当前机器通过 <code>curl http://127.0.0.1:8087</code> 验证）</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#   恢复</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tc qdisc del dev eth0 root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="容器内网络延时">容器内网络延时<a href="#容器内网络延时" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p>如何在容器中注入一个网络延时呢？其实非常简单，Linux 提供了 setns() 函数，可以方便进入指定进程所在命名空间；如果注入网络延时，只需要进入目标容器的网络命名空间即可；</p><ol><li>找到容器的进程</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> inspect --format </span><span class="token string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>进入容器所在命名空间，nsenter 命令最终会调用 setns() 函数，如果没有此命令，需要安装 util-linux 包</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nsenter -t </span><span class="token number" style="color:#36acaa">7921</span><span class="token plain"> -n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>此时查看 IP 相关信息，返回的则是容器内 IP 相关信息</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: lo: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">LOOPBACK,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">65536</span><span class="token plain"> qdisc noqueue state UNKNOWN group default qlen </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inet </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1/8 scope </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> lo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       valid_lft forever preferred_lft forever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">124</span><span class="token plain">: eth0@if125: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BROADCAST,MULTICAST,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"> qdisc noqueue state UP group default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether 02:42:ac:11:00:13 brd ff:ff:ff:ff:ff:ff link-netnsid </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inet </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.19/16 brd </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.255.255 scope global eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       valid_lft forever preferred_lft forever</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>注入网络延时也只会对容器生效</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tc qdisc </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> dev eth0 root netem delay 100ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时在客户端打开浏览器访问 <code>http://IP:8087</code> 会查看到有稳定 100ms 的延时，但是并不会对其他端口生效，比如 22、3306 等等；因为实际延时本身是作用在容器网络命名空间内，并且不会对宿主机生效。
最终成功在不侵入该容器的情况下，给该容器注入网络延时的故障场景。Linux 提供了很多维度的命名空间隔离，并且允许加入任何类型的命名空间，通过 Linux Namespace ，还能做到文件删除、杀进程等等场景</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-实现">chaosblade 实现<a href="#chaosblade-实现" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>在  Chaosblade 1.6.x 版本已经通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，chaosblade-operator 主要负责监听 crd 资源状态变更，chaosblade-operator  不再去执行故障注入的操作，而是由作为 dasemonset 类型资源的 chaosblade-tool 主要负责真正地注入故障，整体实现方案入下图：</p><p><img loading="lazy" alt="image.png" src="/assets/images/current_chaosblade_operator-d1fc557064d7a77d1d9ad6d0644a7a56.png" width="1598" height="896" class="img_ev3q"></p><p>同理可以看到左边的 yaml 定义就是 Chaosblade 混沌实验模型定义，也是 blade 资源实例的一部分信息，当 blade 资源通过 kubectl apply 以后，chaosblade-operator 会监听到资源的创建，同时解析到实验定义；
当解析到 scope = node 的时候，会找到 node 节点所在 chaosblade-tool pod 中执行命令，这些动作几乎对整个集群来说资源消耗也是极少的，这部分和早期版本几乎是没有任何区别的；
但是当解析到 scope = pod 或者  scope = container  的时候， chaosblade-operator 并不会把 chaosblade cli 工具本身复制到业务容器内部，更不会去容器里面执行相关命令，极大地减少了对 kubernetes API 的依赖；那么 chaosblade-operator 究竟是怎么做的呢？ chaosblade-operator 仅仅通过 kubernetes API  找到实验对象，即目标业务 pod，然后继续找到目标业务 pod 所在的节点上部署的 chaosblade-tool pod ，解析 pod 里面的容器名称，最后封装命令直接在 chaosblade-tool 执行命令，去真正地执行故障注入；在 chaosblade-tool 层注入故障的时候已经没有 pod 的概念，这一层是  chaosblade-operator 去解析和封装的；
为何在目标业务 pod 所在的节点上部署的 chaosblade-tool 执行命令，能够直接对目标业务 pod 生效呢？如果你仔细阅读了之前 <strong>Linux 虚拟化 </strong>章节，相信你已经有了答案；chaosblade-tool 作为 daemonset 资源，拥有宿主机 PID 命令空间切换的能力，同时在资源定义时也已经将宿主机 <code>/sys/fs</code> 目录挂载进 chaosblade-tool  pod，使得 chaosblade-tool  能够自由更改进程的 cgroups 控制组；所以 chaosblade-tool 可以对该宿主机上任意容器注入故障，将 chaosblade-operator  的一部分工作剥离了出来，使用 chaosblade-operator  的职责更简单且轻量级，符合最初的设计理论；
Chaosblade-tool  通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，不论是性能、兼容性、稳定性都有极大的提升；因为大部分场景是可以直接 chaosblade-tool 执行的，只要保证  chaosblade-tool  容器依赖库版本和命令能够支持演练，就不会存在兼容性、稳定性等问题；就好比在早起的版本中，我们甚至需要考虑目标业务容器中没有 dd、tc 命令怎么办，或者 dd 版本命令不兼容又怎么办等等问题。
无论 kubernetes 使用 docker、contained、crio 或者其他容器运行时相关技术，Chaosblade 都能做到快速兼容，因为 Chaosblade 通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，对容器运行时相关的 API 依赖并不大，只需要找到容器 1 号进程即可；</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景分析">场景分析<a href="#场景分析" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><p>首先先从 chaosblade 支持的故障场景出发，基于进程维度故障注入的方式可以分为两类：<strong>资源占用和状态变更；</strong>
<strong>资源占用 </strong>注入的方式很容易理解，通过运行可持续占用资源的进程，并且保证进程的持续运行，来达到占用系统资源的目的，通常有 CPU 满载、内存满载、磁盘IO负载、端口占用 等；
<strong>状态变更 </strong>注入的方式可能不是那么贴切，此“状态”可以理解为磁盘可用大小、文件权限、pod 状态等等，实现这种类型的故障注入，我们需要通过运行一个进程来打包修该目标资源的状态即可，当然【状态变更】的方式也有可能进程需要运行很长时间来完成，与【资源占用】不同的是，它需要一个终态来完成故障的注入，即进程执行成功，而不是需要保证进程的持续运行。
将 chaosblade 支持的故障场景分类，得到如下表格：</p><table><thead><tr><th>场景</th><th>分类</th><th>是否加入 Cgroup 控制</th><th>需要进入的命名空间</th></tr></thead><tbody><tr><td>CPU</td><td><strong>资源占用</strong></td><td>是</td><td>PID</td></tr><tr><td>内存</td><td><strong>资源占用</strong></td><td>是</td><td>PID</td></tr><tr><td>磁盘IO</td><td><strong>资源占用</strong></td><td>是</td><td>PID</td></tr><tr><td>磁盘容量</td><td>状态变更</td><td>否</td><td>MNT</td></tr><tr><td>杀进程</td><td>状态变更</td><td>否</td><td>PID</td></tr><tr><td>网络延时、丢包、乱序（主要 tc 实现的场景）</td><td>状态变更</td><td>否</td><td>NET</td></tr><tr><td>网络端口占用</td><td><strong>资源占用</strong></td><td>否</td><td>NET</td></tr><tr><td>文件场景</td><td>状态变更</td><td>否</td><td>MNT</td></tr></tbody></table><p>在资源占用的故障注入模式下，需要判断资源是否是宿主机级别共享的，并且是 Linux Cgroups 已经支持的子系统，比如 CPU、内存、磁盘IO 等等，只需要进入目标容器进程的 PID 命令空间，然后加入目标容器进程控制组即实现故障注入；也有比较特别的，比如网络端口占用，虽然它被列为属于资源占用的故障注入模式，但是端口是独立命名空间内共享的资源，所以他是需要通过 NET 命名空间切换才能实现的。
在状态变更的故障注入模式下，通过需要根据具体场景，进入目标容器进程的命名空间去做一些操作，比如网络场景，需要进入 NET Namespace；文件场景需要进入 MNT Namespace 等等。
在 chaosblade-1.6.x 版本下，也已经提供命名空间切换的实现，比如进入容器（进程 PID 是 35941）命名空间执行 ls 命令：
<img loading="lazy" alt="image.png" src="/assets/images/chaosblade_nsexec-a98a0166c16ce375017052ebe322ac4b.png" width="2224" height="798" class="img_ev3q">
结合场景的注入模式以及 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力，大多数情况下都能分析出场景应该通过什么样的方式在容器注入故障；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="大规模应用演练">大规模应用演练<a href="#大规模应用演练" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>在 Chaosblade 1.6.x 版本已经通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，相比通过工具复制的方式，效率提升显著、兼容性更强、而且无侵入。
在此章节通过实际场景来观测 chaosblade-operator 早期版本和 Chaosblade chaosblade-operator 1.6.x 版本的注入性能和资源消耗情况。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验案例">实验案例<a href="#实验案例" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>分别在 kubernetes 部署  chaosblade-operator 1.5.0 版本和 chaosblade-operator 1.6.1版本，分三次实验，注入 CPU load 场景来观察注入性能、磁盘IO、网络带宽；</p><ul><li>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 20</li><li>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 50</li><li>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 100</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验环境">实验环境<a href="#实验环境" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>三节点 kubernetes 集群，master 为可调度模式</p><table><thead><tr><th>节点/资源</th><th>CPU</th><th>内存</th></tr></thead><tbody><tr><td>master1</td><td>4c</td><td>16g</td></tr><tr><td>node1</td><td>4c</td><td>16g</td></tr><tr><td>node2</td><td>4c</td><td>16g</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验结果">实验结果<a href="#实验结果" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-150-版本">chaosblade-operator 1.5.0 版本<a href="#chaosblade-operator-150-版本" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><p>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 20；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时">注入耗时<a href="#注入耗时" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p>注入耗时达到 57s</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;4fce727793e239cb&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    0m57.851s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.811s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.208s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗">资源消耗<a href="#资源消耗" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p>可以看到网络带宽接受峰值达到 180MBs 左右，传输峰值达到 140MBs 左右
<img loading="lazy" alt="image.png" src="/assets/images/early_stage_exp_20_copies_disk_io-d05ec2dea7257fb1b44c212119b1df59.png" width="2878" height="1100" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/assets/images/early_stage_exp_20_copies_network_bandwidth-3c14094a9659ded1e9868e9660b84747.png" width="2728" height="1266" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 50；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-1">注入耗时<a href="#注入耗时-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p>注入耗时达到 2m25.806s</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;71e07348af26e4aa&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    2m25.806s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m1.010s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.239s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-1">资源消耗<a href="#资源消耗-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/assets/images/early_stage_exp_50_copies_disk_io-42ba88ac6b0340f8a67c06c9e04f78f9.png" width="2868" height="1086" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/assets/images/early_stage_exp_50_copies_network_bandwidth-16d54feea1bdd7bf913d73a1d916a018.png" width="2738" height="1272" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 100；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，为了避免出现超时情况，不太好评估注入耗时，所有此时将等待时间设置为 20 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-2">注入耗时<a href="#注入耗时-2" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 20m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;cc477f2c632e2510&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    4m59.776s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m1.132s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.281s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-2">资源消耗<a href="#资源消耗-2" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/assets/images/early_stage_exp_100_copies_disk_io-de882f23ade07548f7ced9a9149bc81b.png" width="3830" height="1612" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/assets/images/early_stage_exp_100_copies_network_bandwidth-69fd647f914625c62244424a139777ac.png" width="3692" height="1220" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-161-版本">chaosblade-operator 1.6.1 版本<a href="#chaosblade-operator-161-版本" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><p>这次安装 chaosblade-operator 1.6.1 版本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> chaosblade-operator chaosblade-operator-1.5.0.tgz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 20；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-3">注入耗时<a href="#注入耗时-3" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;fe8ebc493bda3d7e&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    0m5.537s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.525s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.067s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-3">资源消耗<a href="#资源消耗-3" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/assets/images/current_exp_20_copies_disk_io-ea14071b2f13d83f49f0c5988a58a1f7.png" width="3824" height="1632" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/assets/images/current_exp_20_copies_network_bandwidth-719f79233975ef4c164d2a637d4cd270.png" width="3700" height="1216" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 50；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-4">注入耗时<a href="#注入耗时-4" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;a4d9c4c9c16642b5&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    0m24.519s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.597s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.071s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-4">资源消耗<a href="#资源消耗-4" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/assets/images/current_exp_50_copies_disk_io-c9014a4a566a2a2f846d0226eb5c6881.png" width="3826" height="1598" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/assets/images/current_exp_50_copies_network_bandwidth-d705936c7f504f0789f1fe0d2f550e00.png" width="3700" height="1230" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 100；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-5">注入耗时<a href="#注入耗时-5" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;f4f4790a369cc448&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    1m46.554s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.696s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.055s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-5">资源消耗<a href="#资源消耗-5" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/assets/images/current_exp_100_copies_disk_io-c2a7cc70901042d516165517fd0b5bb0.png" width="3820" height="1614" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/assets/images/current_exp_100_copies_network_bandwidth-6244940dfc443208d846f0d8cc866ccd.png" width="3692" height="1228" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验总结">实验总结<a href="#实验总结" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-150-版本-1">chaosblade-operator 1.5.0 版本<a href="#chaosblade-operator-150-版本-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><table><thead><tr><th>pod 数量/影响范围</th><th>注入耗时</th><th>磁盘IO影响</th><th>网络带宽影响</th></tr></thead><tbody><tr><td>20</td><td>57s</td><td>略微影响</td><td>影响大</td></tr><tr><td>50</td><td>2m25s</td><td>影响大</td><td>影响大</td></tr><tr><td>100</td><td>4m59s</td><td>影响极大</td><td>影响极大</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-161-版本-1">chaosblade-operator 1.6.1 版本<a href="#chaosblade-operator-161-版本-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4><table><thead><tr><th>pod 数量/影响范围</th><th>注入耗时</th><th>磁盘IO影响</th><th>网络带宽影响</th></tr></thead><tbody><tr><td>20</td><td>5s</td><td>几乎无影响</td><td>几乎无影响</td></tr><tr><td>50</td><td>27s</td><td>几乎无影响</td><td>几乎无影响</td></tr><tr><td>100</td><td>1m46s</td><td>几乎无影响</td><td>几乎无影响</td></tr></tbody></table><p>通过实验结果对比和观测图可以很明显的看到，chaosblade-operator 1.6.1 版本在注入过程中对在资源消耗方面几乎没有任何影响，注入耗时也有明显的提升；
对于其他新特性，比如兼容性提升、只读文件系统pod支持、无侵入等，也可以主动尝试去做更多的实验，相信你会有更深的理解。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="思考">思考<a href="#思考" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-场景支撑">Java 场景支撑<a href="#java-场景支撑" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>ChaosBlade 对于容器 Java 场景的实现，是通过 JVM  attach javaagent 的能力实现的，也就意味着 JVM 在 attach 的时候必须能够查找到 javaagent.jar 包所在路径，所以目前必须将 javaagent.jar 复制进容器；如何能够更优雅做到容器 Java 场景的注入仍然值得我们去探索和突破。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-级别演练支撑">Node 级别演练支撑<a href="#node-级别演练支撑" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>ChaosBlade Operator 对于 Kubernetes Node 级别的演练支持是有限的，在 Node 场景注入故障时候，真正注入的是 chaosblade-tool  容器，chaosblade-tool 默认也只是进程和网络命令空间处在宿主机级别，因此在 chaosblade-tool 容器中支持网络延时、网络丢包、杀进程等场景，其实也是等同 Node 维度的网络延时、网络丢包、杀进程等场景；
对于其他 Kubernetes Node 的支持、并不能真正做到 Node 维度，比如 CPU、内存、磁盘IO 等必须得在  chaosblade-tool  容器没有被限制资源的情景下，才勉强算 Node  维度；而文件系统、Java 场景等目前是没有办法做到的；从另外一个角度出发思考，我们是否需要这些场景，在通常情况下在主机（Node）上安装 chaosblade
完全能够支持全部场景了。</p><p><em>相关链接</em>
<strong><em>ChaosBlade 官方网址</em></strong><em>：</em>
<em><a href="https://chaosblade.io/" target="_blank" rel="noopener noreferrer">https://chaosblade.io/</a></em>
<strong><em>ChaosBlade Github</em></strong><em>：</em>
<em><a href="https://github.com/chaosblade-io/chaosblade" target="_blank" rel="noopener noreferrer">https://github.com/chaosblade-io/chaosblade</a></em>
<strong><em>ChaosBlade 钉钉社区交流群</em></strong><em>：23177705</em></p><h1>作者简介：</h1><p>叶飞（Github账号：tiny-x）ChaosBlade  Maintainer。目前主要关注于混沌工程、云原生以及 Linux 内核相关。</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/chaosblade-io/chaosblade-website/edit/master/blog/2022-11-01-chaosblade-operator.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑本页</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2023/01/09/reviewer-yuanning"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">ChaosBlade Reviewer 晋升通告 -- 晁元宁</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2022/09/09/chaosblade-java"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">ChaosBlade Java 场景性能优化，那些你不知道的事</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chaosblade" class="table-of-contents__link toc-highlight">ChaosBlade</a><ul><li><a href="#资源模型" class="table-of-contents__link toc-highlight">资源模型</a></li><li><a href="#生命周期" class="table-of-contents__link toc-highlight">生命周期</a></li><li><a href="#故障注入" class="table-of-contents__link toc-highlight">故障注入</a></li></ul></li><li><a href="#最初的痛点" class="table-of-contents__link toc-highlight">最初的痛点</a><ul><li><a href="#注入慢" class="table-of-contents__link toc-highlight">注入慢</a></li><li><a href="#网络带宽占用" class="table-of-contents__link toc-highlight">网络带宽占用</a></li><li><a href="#兼容性问题" class="table-of-contents__link toc-highlight">兼容性问题</a></li><li><a href="#只读-pod" class="table-of-contents__link toc-highlight">只读 pod</a></li><li><a href="#侵入型" class="table-of-contents__link toc-highlight">侵入型</a></li></ul></li><li><a href="#优化过程" class="table-of-contents__link toc-highlight">优化过程</a><ul><li><a href="#linux-虚拟化" class="table-of-contents__link toc-highlight">Linux 虚拟化</a></li><li><a href="#chaosblade-实现" class="table-of-contents__link toc-highlight">chaosblade 实现</a></li></ul></li><li><a href="#大规模应用演练" class="table-of-contents__link toc-highlight">大规模应用演练</a><ul><li><a href="#实验案例" class="table-of-contents__link toc-highlight">实验案例</a></li><li><a href="#实验环境" class="table-of-contents__link toc-highlight">实验环境</a></li><li><a href="#实验结果" class="table-of-contents__link toc-highlight">实验结果</a></li><li><a href="#实验总结" class="table-of-contents__link toc-highlight">实验总结</a></li></ul></li><li><a href="#思考" class="table-of-contents__link toc-highlight">思考</a><ul><li><a href="#java-场景支撑" class="table-of-contents__link toc-highlight">Java 场景支撑</a></li><li><a href="#node-级别演练支撑" class="table-of-contents__link toc-highlight">Node 级别演练支撑</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">关于ChaosBlade</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/community">贡献文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://gitter.im/chaosblade-io/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/chaosblade.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/chaosblade-io/shared_invite/zt-f0d3r3f4-TDK13Wr3QRUrAhems28p1w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/">钉钉(23177705)</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cncf.io/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/cncf-white.svg" alt="CNCF" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/cncf-white.svg" alt="CNCF" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">© 2021 The ChaosBlade Authors. All rights reserved. <br>
            The Linux Foundation has registered trademarks and uses trademarks. 
            For a list of trademarks of The Linux Foundation, 
            please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.48f47abc.js"></script>
<script src="/assets/js/main.4a70f144.js"></script>
</body>
</html>